---
comments: true
difficulty: ä¸­ç­‰
edit_url: https://github.com/doocs/leetcode/edit/main/solution/2800-2899/2854.Rolling%20Average%20Steps/README.md
tags:
    - æ•°æ®åº“
---

<!-- problem:start -->

# [2854. æ»šåŠ¨å¹³å‡æ­¥æ•° ğŸ”’](https://leetcode.cn/problems/rolling-average-steps)

[English Version](/solution/2800-2899/2854.Rolling%20Average%20Steps/README_EN.md)

## é¢˜ç›®æè¿°

<!-- description:start -->

<p>è¡¨ï¼š&nbsp;<code><font face="monospace">Steps</font></code></p>

<pre>
+-------------+------+ 
| Column Name | Type | 
+-------------+------+ 
| user_id     | int  | 
| steps_count | int  |
| steps_date  | date |
+-------------+------+
(user_id, steps_date) æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡ŒåŒ…å« user_idã€steps_count å’Œ steps_dateã€‚
</pre>

<p>ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œè®¡ç®—å‡ºæ¯ä¸ªç”¨æˆ·çš„&nbsp;<code>3-day</code> <strong>æ»šåŠ¨å¹³å‡æ­¥æ•°&nbsp;</strong>ã€‚</p>

<p>è®¡ç®— <code>n-day</code> <strong>æ»šåŠ¨å¹³å‡å€¼ </strong>çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p>

<ul>
	<li>å¯¹äºæ¯ä¸€å¤©ï¼Œå¦‚æœæœ‰å¯ç”¨æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šè®¡ç®—ä»¥è¯¥å¤©ä¸ºç»“æŸçš„ <code>n</code> å¤©è¿ç»­æ­¥æ•°çš„å¹³å‡å€¼ï¼Œå¦åˆ™ï¼Œå¯¹äºè¯¥å¤©æ¥è¯´ï¼Œ<code>n</code> å¤©æ»šåŠ¨å¹³å‡æ­¥æ•°æ˜¯æœªå®šä¹‰çš„ã€‚</li>
</ul>

<p>è¾“å‡º <code>user_id</code>&nbsp;ã€ <code>steps_date</code><em> </em>å’Œæ»šåŠ¨å¹³å‡å€¼ã€‚å¹¶å°†æ»šåŠ¨å¹³å‡å€¼å››èˆäº”å…¥åˆ°&nbsp;<strong>ä¸¤ä½å°æ•°</strong>ã€‚</p>

<p>è¿”å›ç»“æœè¡¨ä»¥<code>user_id</code><em>&nbsp;</em>å’Œ <code>steps_date</code><em>&nbsp;</em><strong>å‡åº</strong><em>&nbsp;</em>æ’åºã€‚</p>

<p>ç»“æœçš„æ ¼å¼å¦‚ä¸‹ç¤ºä¾‹ã€‚</p>

<p>&nbsp;</p>

<p><strong class="example">ç¤ºä¾‹ 1:</strong></p>

<pre>
<b>è¾“å…¥ï¼š</b>
Steps table:
+---------+-------------+------------+
| user_id | steps_count | steps_date |
+---------+-------------+------------+
| 1       | 687         | 2021-09-02 |
| 1       | 395         | 2021-09-04 |
| 1       | 499         | 2021-09-05 |
| 1       | 712         | 2021-09-06 |
| 1       | 576         | 2021-09-07 |
| 2       | 153         | 2021-09-06 |
| 2       | 171         | 2021-09-07 |
| 2       | 530         | 2021-09-08 |
| 3       | 945         | 2021-09-04 |
| 3       | 120         | 2021-09-07 |
| 3       | 557         | 2021-09-08 |
| 3       | 840         | 2021-09-09 |
| 3       | 627         | 2021-09-10 |
| 5       | 382         | 2021-09-05 |
| 6       | 480         | 2021-09-01 |
| 6       | 191         | 2021-09-02 |
| 6       | 303         | 2021-09-05 |
+---------+-------------+------------+
<b>è¾“å‡ºï¼š</b>
+---------+------------+-----------------+
| user_id | steps_date | rolling_average | 
+---------+------------+-----------------+
| 1       | 2021-09-06 | 535.33          | 
| 1       | 2021-09-07 | 595.67          | 
| 2       | 2021-09-08 | 284.67          |
| 3       | 2021-09-09 | 505.67          |
| 3       | 2021-09-10 | 674.67          |    
+---------+------------+-----------------+
<b>è§£é‡Šï¼š</b>
- å¯¹äº ID ä¸º 1 çš„ç”¨æˆ·ï¼Œæˆªæ­¢åˆ° 2021-09-06 çš„ä¸‰å¤©è¿ç»­çš„æ­¥æ•°å¯ç”¨ã€‚å› æ­¤ï¼Œè¯¥æ—¥æœŸçš„æ»šåŠ¨å¹³å‡å€¼è®¡ç®—ä¸º (395 + 499 + 712) / 3 = 535.33ã€‚
- å¯¹äº ID ä¸º 1 çš„ç”¨æˆ·ï¼Œæˆªæ­¢åˆ° 2021-09-07 çš„ä¸‰å¤©è¿ç»­çš„æ­¥æ•°å¯ç”¨ã€‚å› æ­¤ï¼Œè¯¥æ—¥æœŸçš„æ»šåŠ¨å¹³å‡å€¼è®¡ç®—ä¸º (499 + 712 + 576) / 3 = 595.67ã€‚
- å¯¹äº ID ä¸º 2 çš„ç”¨æˆ·ï¼Œæˆªæ­¢åˆ° 2021-09-08 çš„ä¸‰å¤©è¿ç»­çš„æ­¥æ•°å¯ç”¨ã€‚å› æ­¤ï¼Œè¯¥æ—¥æœŸçš„æ»šåŠ¨å¹³å‡å€¼è®¡ç®—ä¸º (153 + 171 + 530) / 3 = 284.67ã€‚
- å¯¹äº ID ä¸º 3 çš„ç”¨æˆ·ï¼Œæˆªæ­¢åˆ° 2021-09-09 çš„ä¸‰å¤©è¿ç»­çš„æ­¥æ•°å¯ç”¨ã€‚å› æ­¤ï¼Œè¯¥æ—¥æœŸçš„æ»šåŠ¨å¹³å‡å€¼è®¡ç®—ä¸º (120 + 557 + 840) / 3 = 505.67ã€‚
- å¯¹äº ID ä¸º 3 çš„ç”¨æˆ·ï¼Œæˆªæ­¢åˆ° 2021-09-10 çš„ä¸‰å¤©è¿ç»­çš„æ­¥æ•°å¯ç”¨ã€‚å› æ­¤ï¼Œè¯¥æ—¥æœŸçš„æ»šåŠ¨å¹³å‡å€¼è®¡ç®—ä¸º (557 + 840 + 627) / 3 = 674.67ã€‚
- å¯¹äº ID ä¸º 4 å’Œ 5 çš„ç”¨æˆ·ï¼Œç”±äºè¿ç»­ä¸‰å¤©çš„æ•°æ®ä¸è¶³ï¼Œæ— æ³•è®¡ç®—æ»šåŠ¨å¹³å‡å€¼ã€‚ç»“æœè¡¨æŒ‰ user_id å’Œ steps_date å‡åºæ’åºã€‚</pre>

<!-- description:end -->

## è§£æ³•

<!-- solution:start -->

### æ–¹æ³•ä¸€ï¼šçª—å£å‡½æ•°

æˆ‘ä»¬ç”¨çª—å£å‡½æ•° `LAG() OVER()` æ¥è®¡ç®—æ¯ä¸ªç”¨æˆ·å½“å‰æ—¥æœŸä¸ä¸Šä¸Šä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°å·®ï¼Œå¦‚æœä¸º $2$ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªæ—¥æœŸä¹‹é—´æœ‰è¿ç»­ $3$ å¤©çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨çª—å£å‡½æ•° `AVG() OVER()` æ¥è®¡ç®—è¿™ $3$ ä¸ªæ•°æ®çš„å¹³å‡å€¼ã€‚

<!-- tabs:start -->

```sql
# Write your MySQL query statement below
WITH
    T AS (
        SELECT
            user_id,
            steps_date,
            ROUND(
                AVG(steps_count) OVER (
                    PARTITION BY user_id
                    ORDER BY steps_date
                    ROWS 2 PRECEDING
                ),
                2
            ) AS rolling_average,
            DATEDIFF(
                steps_date,
                LAG(steps_date, 2) OVER (
                    PARTITION BY user_id
                    ORDER BY steps_date
                )
            ) = 2 AS st
        FROM Steps
    )
SELECT
    user_id,
    steps_date,
    rolling_average
FROM T
WHERE st = 1
ORDER BY 1, 2;
```

<!-- tabs:end -->

<!-- solution:end -->

<!-- problem:end -->
