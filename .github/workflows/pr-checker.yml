name: pr-checker

on:
  pull_request_target:
    types: [opened]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Check Team Membership
        id: check_team
        env:
          PR_OPENER: ${{ github.actor }}
        uses: actions/github-script@v5
        with:
            github-token: ${{ secrets.DOOCS_BOT_ACTION_TOKEN }}
            script: |
                const PR_OPENER = process.env.PR_OPENER;
                const comment = 
                `ğŸ¤­ æ„Ÿè°¢ä½ çš„æäº¤ï¼Œè¯·æ£€æŸ¥ä½ çš„æ”¹åŠ¨æ˜¯å¦ç¬¦åˆä»¥ä¸‹é¡¹ç›®è§„èŒƒã€‚

                ### 1. æ ¼å¼åŒ–
                
                æˆ‘ä»¬é¡¹ç›®ä¸­å„ç§ç¼–ç¨‹è¯­è¨€ä»£ç ï¼ˆåŒ…æ‹¬æ–‡æ¡£ï¼‰æ‰€é‡‡ç”¨çš„æ ¼å¼åŒ–å·¥å…·ä¸åŒï¼Œæäº¤ pr ä¹‹å‰å¿…é¡»ç¡®ä¿ä»£ç ã€æ–‡æ¡£æ­£ç¡®æ ¼å¼åŒ–ã€‚
                -   .{md,js,ts,php,sql,rs} é‡‡ç”¨ prettier
                -   .{c,cpp,java} é‡‡ç”¨ clang-format
                -   .{py} é‡‡ç”¨ black
                -   .{go} é‡‡ç”¨ gofmt
                -   å…¶å®ƒå¾…å®Œå–„

                ### 2. Git æäº¤ä¿¡æ¯

                æˆ‘ä»¬é¡¹ç›®éµå¾ª [AngularJS Git Commit Message Conventions](https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#) è§„èŒƒï¼Œæˆ‘ä»¬å¸Œæœ›ä½ çš„æäº¤ä¿¡æ¯å°½å¯èƒ½ä¸é¡¹ç›®ä¿æŒä¸€è‡´ã€‚
                -   æ–°å¢æˆ–ä¿®æ”¹é¢˜è§£ï¼šfeat: add/update solution(s) to lc problem(s): No.xxxx
                -   ä¿®å¤é”™è¯¯ï¼šfix: xxxx
                -   æ—¥å¸¸ç»´æŠ¤ï¼šchore: xxx

                ### 3. å…¶å®ƒè¡¥å……
                
                æ–°å¢é¢˜è§£åŠä»£ç æ—¶ï¼Œéœ€è¦åˆ›å»º Solution.xxx æºä»£ç æ–‡ä»¶ï¼ˆå¦‚æœå·²å­˜åœ¨ï¼Œè¯·ç¡®è®¤ç®—æ³•æ˜¯å¦æ›´ä¼˜ï¼Œæ˜¯åˆ™è¦†ç›–å·²æœ‰ç®—æ³•ä»£ç ï¼‰ï¼ŒåŒæ—¶ï¼Œéœ€è¦åœ¨ README.md ä»¥åŠ README_EN.md ä¸­æ·»åŠ å¯¹åº”çš„ä»£ç ç‰‡æ®µï¼ˆè‹±æ–‡æ–‡ä»¶ä¸­ä¸è¦å‡ºç°ä¸­æ–‡æ³¨é‡Šï¼‰
                å¦å¤–ï¼Œç¼–ç é£æ ¼ï¼ˆæ¯”å¦‚å˜é‡ã€å‡½æ•°çš„å‘½åï¼‰ï¼Œå°½é‡è·Ÿé¡¹ç›®å·²æœ‰ä»£ç ä¿æŒä¸€è‡´ã€‚ 

                ---

                ğŸ¤­ Thank you for your contribution. Please check if your changes comply with the following project specifications. 
                
                ### 1. Formatting

                We use different formatting tools for various programming languages (including documentation) in our project. You must ensure that the code and documentation are correctly formatted before submitting a pr.
                
                -   .{md,js,ts,php,sql,rs} use prettier
                -   .{c,cpp,java} use clang-format
                -   .{py} use black
                -   .{go} use gofmt
                -   Others to be improved

                ### 2. Git Commit Message

                Our project follows the [AngularJS Git Commit Message Conventions](https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#). We hope that your submission information is as consistent as possible with the project.
                -   Add or modify solutions: feat: add/update solution(s) to lc problem(s): No.xxxx
                -   Fix errors: fix: xxxx
                -   Routine maintenance: chore: xxx

                ### 3. Other notes
                
                When adding solutions and code, you need to create a Solution.xxx source code file (if it already exists, please confirm whether the algorithm is better, if yes, overwrite the existing algorithm code), and at the same time, you need to add the corresponding code snippets in README.md and README_EN.md (do not have Chinese comments in the English file)
                In addition, the coding style (such as the naming of variables and functions) should be as consistent as possible with the existing code in the project. 
                <!-- Sticky Pull Request Comment -->`
                
                const checkTeamMembership = async () => {
                  try {
                      const response = await github.request('GET /orgs/{org}/teams/{team_slug}/members', {
                      org: 'doocs',
                      team_slug: 'leetcode-algorithm',
                        headers: {
                          'X-GitHub-Api-Version': '2022-11-28'
                        }
                      })
                    const teamMemberships = response.data;
                    const isTeamMember = teamMemberships.some(member => member.login === PR_OPENER);
                    if (isTeamMember) {
                        console.log(`The user ${PR_OPENER} is a member of the team. Terminating with the workflow.`);
                        return
                    } else {
                      console.log(`The user ${PR_OPENER} is not a member of the team. Proceeding the workflow.`);
                      github.rest.issues.createComment({
                        issue_number: context.issue.number,
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        body: comment
                      })
                    }
                  } catch (error) {
                    console.log(PR_OPENER)
                    console.log(error)
                  }
                  }
                  checkTeamMembership();